<h2>Задание:</h2>
<p>Разработать программу для пакетной обработки команд.<br />
Команды считываются построчно из стандартного ввода и обрабатываются блоками
по N команд.<br />
Одна команда - одна строка, значение роли не играет.<br />
Если данные закончились - блок завершается принудительно.<br />
Параметр N передается как единственный параметр командной строки в виде целого числа.</p>
<table>
<tr><td>input</td><td>output</td></tr>
<tr><td>cmd1</td><td> </td></tr>
<tr><td>cmd2<td> </td></tr>
<tr><td>cmd3</td><td> </td></tr>
<tr><td> </td><td>bulk: cmd1, cmd2, cmd3</td></tr>
<tr><td>cmd4</td><td> </td></tr>
<tr><td>cmd5</td><td> </td></tr>
<tr><td> </td><td>bulk: cmd4, cmd5</td></tr>
</table>
<p>Размер блока можно изменить динамически, если перед началом блока и
сразу после дать команды { и } соответственно. Предыдущий пакет при
этом принудительно завершается.</p>
<p>Такие блоки могут быть включены друг в друга при этом вложенные блоки
игнорируются.</p>
<p>Если данные закончились внутри блока - блоки игнорируется целиком.</p>
<p>Вместе с выводом в консоль блоки должны сохранятся в отдельные файлы
с именами bulk1517223860.log, где 1517223860 - это время получения
первой команды из блока.</p>

<p>Ввод данных осуществляется по сети.</p>
<p>Необходимо разработать асинхронный сервер, работающий с протоколом
аналогичным консоли, принимающий построчно команды. Дальнейшая
обработка остается без изменений - вывод на консоль и в файлы.</p>
<p>В качестве библиотеки сетевого взаимодействия можно использовать
boost.asio (можно использовать любую предоставляющую асинхронные
возможности).</p>
<p>Поскольку не предполагается отправка данных основное взаимодействие
будет вокруг методов async_read и async_accept.</p>
<p>Порядок запуска:<br />
$ bulk_server &ltport&gt &ltbulk_size&gt<br />
где<br />
• port – номер tcp порта для входящих соединений. Соединения должны обслуживаться с произвольных интерфейсов.<br />
• bulk_size – уже знакомый размер блока команд.<p>

<p>Вывод обработанных команд выполняется параллельно. При старте программы должно быть
создано, в дополнение к существующему основному потоку, еще три
дополнительных.</p>
<p>Дадим им условные имена:<br />
• main - основной поток,<br />
• log - поток для вывода в консоль<br />
• file1 - первый поток для вывода в файл<br />
• file2 - второй поток для вывода в файл</ul></p>
<p>Основная логика обработки меняется таким образом, что блок команд,
сразу после своего формирования должен быть отправлен в консоль и
файл одновременно. При этом, отправка блока в файл должна быть
распределена между двумя потоками.</p>
<p>Следует обратить внимание на недостаточную точность часов для
формирования уникального имени. Необходимо, сохранив timestamp в
имени, добавить дополнительную секцию, которая будет гарантирована
отличаться.</p>
<p>В условиях многопоточной обработки ведение логов может оказаться
затратной процедурой и невольным синхронизатором потоков. В данной
задаче необходимо ввести дополнительные счетчики операций, которые
должны быть выведены на консоль в конце работы программы.</p>
<p>На каждый дополнительный поток два счетчика:<br />
• количество блоков<br />
• общее количество команд в блоках<br />
В основном потоке три счетчика:<br />
• количество строк считанных из файла (команды + { + } )<br />
• количество команд<br />
• количество блоков<br /></p>
